@using IaEapp.DTO
@model PaginatedList<TransactionDTO>

@{
    ViewData["Title"] = "Transakce";
}

<div class="row mb-4">
    <div class="col">
        <h1 class="h3 fw-bold">Transakce</h1>
        <p class="text-muted mb-0">Přehled příjmů a výdajů</p>
    </div>

    <div class="col text-end">
        <a class="btn btn-outline-secondary me-2" asp-controller="FileXmlUpload" asp-action="Index">Import z XML</a>
        <a class="btn btn-success" asp-action="Create">+ Nová transakce</a>
    </div>
</div>

<!-- FILTERS -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form asp-action="Index" method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Zadej:</label>
                <input type="text" name="q" value="@ViewData["CurrentFilter"]" class="form-control" placeholder="Popis, kategorie..." />
            </div>
            <div class="col-md-8">
                <label class="form-label d-block">Rychlé filtry</label>
                <div class="btn-group flex-wrap">
                    <a class="btn btn-outline-primary" asp-route-sortOrder="@ViewData["IncomeSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">Příjmy</a>
                    <a class="btn btn-outline-primary" asp-route-sortOrder="@ViewData["ExpanseSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">Výdaje</a>
                    <a class="btn btn-outline-secondary" asp-route-sortOrder="@ViewData["LastMonth"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">Minulý měsíc</a>
                    <a class="btn btn-outline-secondary" asp-route-sortOrder="@ViewData["ThisMonth"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">Tento měsíc</a>
                    <a class="btn btn-outline-secondary" asp-route-sortOrder="@ViewData["Last30DaysSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">30 dní</a>
                    <a class="btn btn-outline-dark" asp-action="Index">Vše</a>
                </div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Hledat</button>
            </div>

        </form>
    </div>
</div>

<!-- TABLE -->
<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Datum</th>
                    <th>Popis</th>
                    <th>Částka</th>
                    <th>Kategorie</th>
                    <th>Uživatel</th>
                    <th class="text-end">Akce</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model) {
                    <tr>
                        <td>@item.Date.ToString("yyyy-MM-dd")</td>
                        <td>@item.Description</td>
                        <td class="fw-semibold @(item.Income ? "text-success" : "text-danger")">@item.Amount Kč</td>
                        <td>@item.TransactionCategoryName</td>
                        <td>@item.UserName</td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-warning" asp-action="Edit" asp-route-id="@item.Id">Upravit</a>
                            <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@item.Id">Smazat</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>

<!-- PAGINATION -->
<div class="d-flex justify-content-between align-items-center mt-3">
    <small class="text-muted">
        Stránka @Model.PageIndex z @Model.TotalPages
        (@Model.TotalCount položek)
    </small>
    <nav>
        <ul class="pagination mb-0">
            <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                <a class="page-link" asp-route-pageNumber="@(Model.PageIndex - 1)" asp-route-sortOrder="@ViewData["CurrentSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">
                    &laquo;
                </a>
            </li>
            @foreach (var pageNum in Model.PageNumbers) {
                if (pageNum == -1) {
                    <li class="page-item disabled">
                        <span class="page-link">…</span>
                    </li>
                } else {
                    <li class="page-item @(pageNum == Model.PageIndex ? "active" : "")">
                        <a class="page-link" asp-route-pageNumber="@pageNum" asp-route-sortOrder="@ViewData["CurrentSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">
                            @pageNum
                        </a>
                    </li>
                }
            }
            <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                <a class="page-link" asp-route-pageNumber="@(Model.PageIndex + 1)" asp-route-sortOrder="@ViewData["CurrentSort"]" asp-route-currentFilter="@ViewData["CurrentFilter"]">
                    &raquo;
                </a>
            </li>
        </ul>
    </nav>
</div>
